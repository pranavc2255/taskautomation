<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taskautomation - Smart Task Manager</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --primary-hover: #4f46e5;
            --primary-light: #e0e7ff;
            --bg: #fafafa;
            --card: #ffffff;
            --text: #1e1e2e;
            --text-light: #6b7280;
            --danger: #ef4444;
            --danger-hover: #dc2626;
            --success: #10b981;
            --success-light: #d1fae5;
            --warning: #f59e0b;
            --category: #8b5cf6;
            --number-bg: #eef2ff;
            --number-text: #4338ca;
            --code-bg: #1e1e2e;
            --code-text: #a5b4fc;
            --border: #e5e7eb;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.6;
            font-size: 16px;
            min-height: 100vh;
        }

        /* Auth Container */
        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: relative;
            overflow: hidden;
        }

        .auth-container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: drift 20s linear infinite;
        }

        @keyframes drift {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        .auth-box {
            background: var(--card);
            padding: 50px 40px;
            border-radius: 24px;
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 420px;
            position: relative;
            z-index: 1;
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .auth-box h1 {
            font-size: 2rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 8px;
            color: var(--text);
        }

        .auth-box .subtitle {
            text-align: center;
            color: var(--text-light);
            margin-bottom: 35px;
            font-size: 1rem;
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 30px;
            background: var(--bg);
            border-radius: 12px;
            padding: 5px;
        }

        .auth-tab {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-family: inherit;
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-light);
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .auth-tab.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.4);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text);
            font-size: 0.95rem;
        }

        .form-group input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.2s ease;
            background: var(--bg);
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }

        .btn-auth {
            width: 100%;
            padding: 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .btn-auth:hover {
            background: var(--primary-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
        }

        .btn-auth:disabled {
            background: #cbd5e1;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .auth-error {
            background: #fef2f2;
            color: var(--danger);
            padding: 12px 16px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 0.95rem;
            display: none;
            border: 1px solid #fecaca;
        }

        .auth-error.show {
            display: block;
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .forgot-password {
            text-align: center;
            margin-top: 20px;
        }

        .forgot-password a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.95rem;
        }

        .forgot-password a:hover {
            text-decoration: underline;
        }

        /* Main App Container */
        .app-container {
            display: none;
            max-width: 950px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .app-container.active {
            display: block;
        }

        /* Header */
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .app-header h1 {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--text);
            letter-spacing: -0.02em;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            background: var(--card);
            padding: 10px 20px;
            border-radius: 50px;
            box-shadow: var(--shadow);
        }

        .user-email {
            font-size: 0.95rem;
            color: var(--text-light);
            font-weight: 500;
        }

        .btn-logout {
            background: transparent;
            color: var(--danger);
            border: 2px solid var(--danger);
            padding: 8px 18px;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .btn-logout:hover {
            background: var(--danger);
            color: white;
        }

        .app-subtitle {
            color: var(--text-light);
            font-size: 1.1rem;
            margin-bottom: 40px;
            text-align: center;
        }

        /* Cards */
        .card {
            background: var(--card);
            padding: 30px;
            border-radius: 16px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--border);
        }

        .card h3 {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card p {
            color: var(--text-light);
            margin-bottom: 15px;
        }

        /* Code Block */
        .code-block {
            background: var(--code-bg);
            color: var(--code-text);
            padding: 20px;
            border-radius: 12px;
            font-family: 'Space Mono', 'Menlo', monospace;
            white-space: pre-wrap;
            font-size: 0.9rem;
            line-height: 1.7;
            overflow-x: auto;
            margin: 15px 0;
        }

        /* Form Elements */
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text);
        }

        textarea {
            width: 100%;
            height: 130px;
            padding: 16px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-family: 'Space Mono', monospace;
            font-size: 0.95rem;
            resize: vertical;
            transition: all 0.2s ease;
            margin-bottom: 15px;
            background: var(--bg);
        }

        textarea:focus {
            outline: none;
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }

        /* Buttons */
        .btn-primary {
            background: var(--primary);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 12px;
            font-size: 1.05rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
            width: 100%;
        }

        .btn-primary:hover {
            background: var(--primary-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .btn-secondary {
            background: #475569;
            color: white;
            border: none;
            padding: 12px 22px;
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .btn-secondary:hover {
            background: #334155;
        }

        .btn-danger-outline {
            background: transparent;
            color: var(--danger);
            border: 2px solid var(--danger);
            padding: 12px 22px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .btn-danger-outline:hover {
            background: var(--danger);
            color: white;
        }

        /* Filter Controls */
        .filter-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
            padding: 25px;
            background: var(--card);
            border-radius: 16px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            align-items: flex-end;
            justify-content: space-between;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .filter-group label {
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-light);
            margin-bottom: 0;
        }

        .filter-select {
            padding: 12px 40px 12px 16px;
            border-radius: 10px;
            border: 2px solid var(--border);
            background: white;
            cursor: pointer;
            font-size: 1rem;
            font-family: inherit;
            color: var(--text);
            min-width: 200px;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236366f1' stroke-width='2'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M19 9l-7 7-7-7' /%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 14px center;
            background-size: 18px;
            transition: all 0.2s ease;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Task List */
        #taskList {
            list-style: none;
            padding: 0;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .task-item {
            background: var(--card);
            border: 1px solid var(--border);
            border-left: 5px solid var(--primary);
            padding: 22px;
            border-radius: 14px;
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .task-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .task-number-box {
            background: var(--number-bg);
            color: var(--number-text);
            font-weight: 700;
            font-size: 1rem;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            margin-right: 18px;
            flex-shrink: 0;
        }

        .task-item.completed {
            background: #f8fafc;
            border-left-color: var(--success);
            opacity: 0.7;
        }

        .task-item.completed .task-number-box {
            background: #f1f5f9;
            color: #94a3b8;
        }

        .task-content {
            flex-grow: 1;
            padding-right: 20px;
        }

        .task-title {
            font-weight: 600;
            font-size: 1.15rem;
            display: block;
            margin-bottom: 10px;
            color: var(--text);
            line-height: 1.4;
        }

        .task-item.completed .task-title {
            text-decoration: line-through;
            color: #94a3b8;
        }

        .task-meta {
            font-size: 0.9rem;
            color: var(--text-light);
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-items: center;
        }

        .category-tag {
            background: linear-gradient(135deg, #e0e7ff, #c7d2fe);
            color: var(--category);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }

        .task-item.completed .category-tag {
            background: #e2e8f0;
            color: #64748b;
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .check-input {
            width: 24px;
            height: 24px;
            cursor: pointer;
            border-radius: 6px;
            accent-color: var(--success);
        }

        .btn-delete {
            background: white;
            color: var(--danger);
            border: 1px solid #fee2e2;
            padding: 10px 16px;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            flex-shrink: 0;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .btn-delete:hover {
            background: #fef2f2;
            border-color: var(--danger);
        }

        /* Status Indicator */
        .status-indicator {
            text-align: center;
            font-size: 0.85rem;
            font-weight: 600;
            padding: 8px 16px;
            border-radius: 25px;
            display: inline-block;
            margin-bottom: 25px;
        }

        .status-online {
            color: var(--success);
            background: var(--success-light);
        }

        .status-offline {
            color: var(--warning);
            background: #fef3c7;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-light);
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: var(--text);
        }

        /* Footer */
        .credits {
            text-align: center;
            margin-top: 60px;
            padding-top: 30px;
            border-top: 1px solid var(--border);
            color: var(--text-light);
            font-size: 0.95rem;
        }

        .credits a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
        }

        .credits a:hover {
            text-decoration: underline;
        }

        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .app-header {
                flex-direction: column;
                text-align: center;
            }

            .user-info {
                width: 100%;
                justify-content: center;
            }

            .filter-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .filter-select {
                width: 100%;
            }

            .task-item {
                flex-direction: column;
                gap: 15px;
            }

            .btn-delete {
                width: 100%;
            }
        }

        /* Password Reset Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal-box {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 400px;
            width: 100%;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
        }

        .modal-box h2 {
            margin-bottom: 10px;
        }

        .modal-box p {
            color: var(--text-light);
            margin-bottom: 25px;
        }

        .success-message {
            background: var(--success-light);
            color: var(--success);
            padding: 12px 16px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        .success-message.show {
            display: block;
        }
    </style>
</head>
<body>

    <!-- AUTH SECTION -->
    <div class="auth-container" id="authContainer">
        <div class="auth-box">
            <h1>‚ú® Taskautomation</h1>
            <p class="subtitle">Organize your meetings into actionable tasks</p>

            <div class="auth-error" id="authError"></div>

            <div class="auth-tabs">
                <button class="auth-tab active" onclick="switchTab('login')">Sign In</button>
                <button class="auth-tab" onclick="switchTab('signup')">Sign Up</button>
            </div>

            <!-- Login Form -->
            <form class="auth-form active" id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label for="loginEmail">Email Address</label>
                    <input type="email" id="loginEmail" placeholder="you@example.com" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="6">
                </div>
                <button type="submit" class="btn-auth" id="loginBtn">Sign In</button>
                <div class="forgot-password">
                    <a href="#" onclick="showResetModal(event)">Forgot your password?</a>
                </div>
            </form>

            <!-- Signup Form -->
            <form class="auth-form" id="signupForm" onsubmit="handleSignup(event)">
                <div class="form-group">
                    <label for="signupEmail">Email Address</label>
                    <input type="email" id="signupEmail" placeholder="you@example.com" required>
                </div>
                <div class="form-group">
                    <label for="signupPassword">Password</label>
                    <input type="password" id="signupPassword" placeholder="Min. 6 characters" required minlength="6">
                </div>
                <div class="form-group">
                    <label for="signupConfirm">Confirm Password</label>
                    <input type="password" id="signupConfirm" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="6">
                </div>
                <button type="submit" class="btn-auth" id="signupBtn">Create Account</button>
            </form>
        </div>
    </div>

    <!-- PASSWORD RESET MODAL -->
    <div class="modal-overlay" id="resetModal">
        <div class="modal-box">
            <button class="modal-close" onclick="hideResetModal()">&times;</button>
            <h2>Reset Password</h2>
            <p>Enter your email and we'll send you a reset link.</p>
            <div class="success-message" id="resetSuccess">Password reset email sent! Check your inbox.</div>
            <div class="auth-error" id="resetError"></div>
            <form onsubmit="handlePasswordReset(event)">
                <div class="form-group">
                    <label for="resetEmail">Email Address</label>
                    <input type="email" id="resetEmail" placeholder="you@example.com" required>
                </div>
                <button type="submit" class="btn-auth" id="resetBtn">Send Reset Link</button>
            </form>
        </div>
    </div>

    <!-- MAIN APP SECTION -->
    <div class="app-container" id="appContainer">
        <header class="app-header">
            <h1>‚ú® Taskautomation</h1>
            <div class="user-info">
                <span class="user-email" id="userEmail">user@email.com</span>
                <button class="btn-logout" onclick="handleLogout()">Sign Out</button>
            </div>
        </header>

        <p class="app-subtitle">Automatically organize your meeting notes into a prioritized, actionable task list.</p>

        <div style="text-align: center;">
            <span class="status-indicator" id="statusIndicator">Initializing...</span>
        </div>

        <!-- AI Helper Section -->
        <div class="card">
            <h3>ü§ñ Extract Tasks from Meetings</h3>
            <p>Paste this prompt into ChatGPT, Claude, or Gemini along with your meeting notes:</p>
            <div class="code-block" id="aiPrompt">Please analyze the meeting data I provide below. Extract all tasks and action items.

Format the output strictly as a list, with one task per line using this exact format:
Task Description -- Category -- Deadline (YYYY-MM-DD) -- Date Assigned: YYYY-MM-DD

Rules:
1. If no specific deadline is mentioned, write "0000-00-00".
2. If "today" is mentioned for assignment date, use the actual date of the meeting.
3. Categories examples: Work, Personal, Research, Admin, Finance.
4. Do not use bullet points or numbering at the start of the line.

Here is the meeting data:
[PASTE YOUR MEETING NOTES HERE]</div>
            <button class="btn-secondary" onclick="copyPrompt()">üìã Copy Prompt</button>
        </div>

        <!-- Input Section -->
        <div class="card">
            <label for="rawInput"><strong>Paste your formatted tasks below:</strong></label>
            <p style="font-size: 0.95rem; color: var(--text-light); margin-bottom: 15px;">
                <strong style="color: var(--primary);">Format:</strong> Task Name -- Category -- Deadline -- Date Assigned
            </p>
            <textarea id="rawInput" placeholder="Example: Submit Q3 Report -- Finance -- Deadline: 2025-10-15 -- Assigned: 2025-10-01"></textarea>
            <button class="btn-primary" onclick="processText()">‚ûï Add Tasks to List</button>
        </div>

        <!-- Filter Controls -->
        <div class="filter-controls">
            <div class="filter-group">
                <label for="categoryFilter">Filter by Category</label>
                <select id="categoryFilter" onchange="setFilter(this.value)" class="filter-select"></select>
            </div>
            <div class="filter-group">
                <label for="sortOrder">Sort by Date</label>
                <select id="sortOrder" onchange="setSortOrder(this.value)" class="filter-select">
                    <option value="desc" selected>Latest First</option>
                    <option value="asc">Earliest First</option>
                </select>
            </div>
            <button class="btn-danger-outline" onclick="deleteAllTasks()">üóëÔ∏è Delete All</button>
        </div>

        <!-- Task List -->
        <ul id="taskList"></ul>

        <div class="credits">
            Created by Pranav Chougule | <a href="mailto:pranavc2204@gmail.com">pranavc2204@gmail.com</a>
        </div>
    </div>

    <!-- FIREBASE SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, 
            signOut, 
            onAuthStateChanged,
            sendPasswordResetEmail
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, 
            collection, 
            doc, 
            setDoc, 
            updateDoc, 
            deleteDoc, 
            onSnapshot, 
            writeBatch,
            query,
            where
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // ============================================
        // üî• FIREBASE CONFIGURATION
        // ============================================
        // IMPORTANT: Replace with your Firebase project config
        // Get this from: Firebase Console > Project Settings > Your apps > Config
        const firebaseConfig = {
            apiKey: "AIzaSyDA8inJ1PUy1r2PR7RrPcM5zZxlyB2qlZ8",
            authDomain: "taskautomation-v1.firebaseapp.com",
            projectId: "taskautomation-v1",
            storageBucket: "taskautomation-v1.firebasestorage.app",
            messagingSenderId: "710824600767",
            appId: "1:710824600767:web:b9b86a63dc1b1e3ed7520a",
            measurementId: "G-0B6MHS9NHD"
        };
        // ============================================

        // Initialize Firebase
        let app, auth, db, user, tasksCollection;
        let tasks = [];
        let isFirebaseConfigured = false;

        const CATEGORIES = ["All", "Work", "Personal", "Finance", "Urgent", "Admin", "Research", "Academic", "Other"];
        let currentFilter = "All";
        let currentSortOrder = "desc";
        const LOCAL_STORAGE_KEY = 'taskautomation_tasks';

        // Check if Firebase is configured
        if (firebaseConfig.apiKey && firebaseConfig.apiKey !== "YOUR_API_KEY") {
            try {
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                isFirebaseConfigured = true;
            } catch (e) {
                console.error("Firebase init error:", e);
            }
        }

        // DOM Elements
        const authContainer = document.getElementById('authContainer');
        const appContainer = document.getElementById('appContainer');
        const statusEl = document.getElementById('statusIndicator');
        const authError = document.getElementById('authError');
        const userEmailEl = document.getElementById('userEmail');

        // ============================================
        // AUTH STATE MANAGEMENT
        // ============================================
        if (isFirebaseConfigured) {
            onAuthStateChanged(auth, (currentUser) => {
                if (currentUser) {
                    user = currentUser;
                    showApp();
                    setupTaskListener();
                } else {
                    user = null;
                    showAuth();
                }
            });
        } else {
            // Show warning if Firebase not configured
            showConfigWarning();
        }

        function showApp() {
            authContainer.style.display = 'none';
            appContainer.classList.add('active');
            userEmailEl.textContent = user.email;
            statusEl.textContent = "‚òÅÔ∏è Cloud Sync Active";
            statusEl.className = "status-indicator status-online";
        }

        function showAuth() {
            authContainer.style.display = 'flex';
            appContainer.classList.remove('active');
        }

        function showConfigWarning() {
            authError.innerHTML = `
                <strong>‚ö†Ô∏è Firebase Not Configured</strong><br>
                Please add your Firebase config to the code. See setup instructions below.
            `;
            authError.classList.add('show');
            document.querySelectorAll('.btn-auth').forEach(btn => btn.disabled = true);
        }

        // ============================================
        // AUTH FUNCTIONS
        // ============================================
        window.switchTab = function(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            
            if (tab === 'login') {
                document.querySelector('.auth-tab:first-child').classList.add('active');
                document.getElementById('loginForm').classList.add('active');
            } else {
                document.querySelector('.auth-tab:last-child').classList.add('active');
                document.getElementById('signupForm').classList.add('active');
            }
            authError.classList.remove('show');
        };

        window.handleLogin = async function(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const btn = document.getElementById('loginBtn');

            btn.disabled = true;
            btn.innerHTML = '<span class="spinner"></span> Signing in...';
            authError.classList.remove('show');

            try {
                await signInWithEmailAndPassword(auth, email, password);
            } catch (error) {
                showAuthError(error.code);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Sign In';
            }
        };

        window.handleSignup = async function(e) {
            e.preventDefault();
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const confirm = document.getElementById('signupConfirm').value;
            const btn = document.getElementById('signupBtn');

            if (password !== confirm) {
                authError.textContent = "Passwords don't match!";
                authError.classList.add('show');
                return;
            }

            btn.disabled = true;
            btn.innerHTML = '<span class="spinner"></span> Creating account...';
            authError.classList.remove('show');

            try {
                await createUserWithEmailAndPassword(auth, email, password);
            } catch (error) {
                showAuthError(error.code);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Create Account';
            }
        };

        window.handleLogout = async function() {
            if (confirm("Are you sure you want to sign out?")) {
                await signOut(auth);
            }
        };

        window.showResetModal = function(e) {
            e.preventDefault();
            document.getElementById('resetModal').classList.add('show');
            document.getElementById('resetSuccess').classList.remove('show');
            document.getElementById('resetError').classList.remove('show');
        };

        window.hideResetModal = function() {
            document.getElementById('resetModal').classList.remove('show');
        };

        window.handlePasswordReset = async function(e) {
            e.preventDefault();
            const email = document.getElementById('resetEmail').value;
            const btn = document.getElementById('resetBtn');
            const successEl = document.getElementById('resetSuccess');
            const errorEl = document.getElementById('resetError');

            btn.disabled = true;
            btn.innerHTML = '<span class="spinner"></span> Sending...';
            errorEl.classList.remove('show');

            try {
                await sendPasswordResetEmail(auth, email);
                successEl.classList.add('show');
            } catch (error) {
                errorEl.textContent = getErrorMessage(error.code);
                errorEl.classList.add('show');
            } finally {
                btn.disabled = false;
                btn.textContent = 'Send Reset Link';
            }
        };

        function showAuthError(code) {
            authError.textContent = getErrorMessage(code);
            authError.classList.add('show');
        }

        function getErrorMessage(code) {
            const messages = {
                'auth/email-already-in-use': 'This email is already registered. Try signing in.',
                'auth/invalid-email': 'Please enter a valid email address.',
                'auth/weak-password': 'Password should be at least 6 characters.',
                'auth/user-not-found': 'No account found with this email.',
                'auth/wrong-password': 'Incorrect password. Try again.',
                'auth/invalid-credential': 'Invalid email or password.',
                'auth/too-many-requests': 'Too many attempts. Please try again later.',
                'auth/network-request-failed': 'Network error. Check your connection.'
            };
            return messages[code] || 'An error occurred. Please try again.';
        }

        // ============================================
        // TASK MANAGEMENT
        // ============================================
        function setupTaskListener() {
            tasksCollection = collection(db, 'users', user.uid, 'tasks');
            onSnapshot(tasksCollection, (snapshot) => {
                tasks = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(tasks));
                renderTasks();
            }, (error) => {
                console.error("Firestore error:", error);
                statusEl.textContent = "‚ö†Ô∏è Sync Error";
                statusEl.className = "status-indicator status-offline";
                loadLocalTasks();
            });
        }

        function loadLocalTasks() {
            const stored = localStorage.getItem(LOCAL_STORAGE_KEY);
            if (stored) {
                try {
                    tasks = JSON.parse(stored);
                    renderTasks();
                } catch (e) {}
            }
        }

        window.processText = async function() {
            const inputArea = document.getElementById('rawInput');
            const text = inputArea.value.trim();
            if (!text) return;

            const lines = text.split('\n').filter(line => line.trim().length > 0);
            const newItems = [];

            lines.forEach(line => {
                // Sanitize input to prevent XSS
                const sanitized = line.replace(/</g, '&lt;').replace(/>/g, '&gt;');
                const parts = sanitized.split('--').map(part => part.trim());
                
                if (parts.length >= 3) {
                    const taskObj = {
                        id: Date.now().toString(36) + Math.random().toString(36).substring(2),
                        title: parts[0] || "Unknown Task",
                        category: parts.length >= 4 ? parts[1] : "Other",
                        deadline: parts.length >= 4 ? parts[2] : parts[1] || "",
                        assigned: parts.length >= 4 ? parts[3] : parts[2] || "",
                        completed: false,
                        createdAt: Date.now(),
                        userId: user.uid
                    };
                    newItems.push(taskObj);
                }
            });

            if (newItems.length === 0) {
                alert("No valid tasks found. Please check the format.");
                return;
            }

            try {
                const batch = writeBatch(db);
                newItems.forEach(item => {
                    const docRef = doc(tasksCollection, item.id);
                    batch.set(docRef, item);
                });
                await batch.commit();
                inputArea.value = '';
            } catch (error) {
                console.error("Error adding tasks:", error);
                alert("Error saving tasks. Please try again.");
            }
        };

        window.toggleComplete = async function(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            try {
                const taskDoc = doc(db, 'users', user.uid, 'tasks', taskId);
                await updateDoc(taskDoc, { completed: !task.completed });
            } catch (error) {
                console.error("Error updating task:", error);
            }
        };

        window.deleteTask = async function(taskId) {
            try {
                const taskDoc = doc(db, 'users', user.uid, 'tasks', taskId);
                await deleteDoc(taskDoc);
            } catch (error) {
                console.error("Error deleting task:", error);
            }
        };

        window.deleteAllTasks = async function() {
            if (confirm("Are you sure you want to delete ALL tasks? This cannot be undone.")) {
                try {
                    const batch = writeBatch(db);
                    tasks.forEach(t => {
                        const taskDoc = doc(db, 'users', user.uid, 'tasks', t.id);
                        batch.delete(taskDoc);
                    });
                    await batch.commit();
                } catch (error) {
                    console.error("Error deleting all tasks:", error);
                }
            }
        };

        window.setFilter = (category) => { currentFilter = category; renderTasks(); };
        window.setSortOrder = (order) => { currentSortOrder = order; renderTasks(); };

        function extractDate(task) {
            const match = (task.assigned || '').match(/(\d{4}-\d{2}-\d{2})/);
            const dateStr = match ? match[1] : null;
            return (dateStr === '0000-00-00') ? null : dateStr;
        }

        function renderTasks() {
            const list = document.getElementById('taskList');
            list.innerHTML = '';

            const filteredTasks = tasks.filter(task => {
                const taskCategory = task.category || "Other";
                return currentFilter === "All" || taskCategory.toLowerCase() === currentFilter.toLowerCase();
            });

            if (filteredTasks.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
                        </svg>
                        <h3>No tasks yet</h3>
                        <p>Use the AI prompt above to extract tasks from your meeting notes!</p>
                    </div>
                `;
                renderCategoryFilter();
                return;
            }

            const chronologicalTasks = [...filteredTasks].sort((a, b) => {
                const dateA = extractDate(a);
                const dateB = extractDate(b);
                if (dateA && !dateB) return -1;
                if (!dateA && dateB) return 1;
                if (!dateA && !dateB) return (a.createdAt || 0) - (b.createdAt || 0);
                return dateA < dateB ? -1 : 1;
            });

            chronologicalTasks.forEach((task, index) => { task.displayNum = index + 1; });

            const finalTasks = [...chronologicalTasks].sort((a, b) => {
                if (a.completed !== b.completed) return a.completed ? 1 : -1;
                return currentSortOrder === 'asc' ? a.displayNum - b.displayNum : b.displayNum - a.displayNum;
            });

            finalTasks.forEach(task => {
                const li = document.createElement('li');
                li.className = `task-item ${task.completed ? 'completed' : ''}`;
                li.innerHTML = `
                    <div class="task-number-box">${task.displayNum}</div>
                    <div class="checkbox-container">
                        <input type="checkbox" class="check-input" ${task.completed ? 'checked' : ''} onchange="toggleComplete('${task.id}')" aria-label="Mark task complete">
                    </div>
                    <div class="task-content">
                        <span class="task-title">${task.title}</span>
                        <div class="task-meta">
                            <span class="category-tag">${task.category || 'Other'}</span>
                            <span>${task.deadline}${task.deadline && task.assigned ? ' | ' : ''}${task.assigned}</span>
                        </div>
                    </div>
                    <button class="btn-delete" onclick="deleteTask('${task.id}')" aria-label="Delete task">Delete</button>
                `;
                list.appendChild(li);
            });

            renderCategoryFilter();
        }

        function renderCategoryFilter() {
            const select = document.getElementById('categoryFilter');
            select.innerHTML = '';
            CATEGORIES.forEach(cat => {
                const opt = document.createElement('option');
                opt.value = cat;
                opt.textContent = cat;
                if (cat === currentFilter) opt.selected = true;
                select.appendChild(opt);
            });
        }

        window.copyPrompt = function() {
            const promptText = document.getElementById('aiPrompt').innerText;
            const btn = document.querySelector('.btn-secondary');
            
            navigator.clipboard.writeText(promptText).then(() => {
                btn.textContent = "‚úÖ Copied!";
                btn.style.background = "var(--success)";
                setTimeout(() => {
                    btn.textContent = "üìã Copy Prompt";
                    btn.style.background = "#475569";
                }, 2000);
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement("textarea");
                textArea.value = promptText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                btn.textContent = "‚úÖ Copied!";
                setTimeout(() => btn.textContent = "üìã Copy Prompt", 2000);
            });
        };

        // Initial render
        renderCategoryFilter();
    </script>
</body>
</html>
